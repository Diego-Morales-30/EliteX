@model IEnumerable<FileData.Models.Usuario>

<link rel="stylesheet" href="~/Estilos/DashConsultar.css" />

<div class="tabla-consultar-container">
    <h1 class="titulo-consultar">🔎 Consultar Usuario</h1>

    <div class="buscar-container">
        <input type="text" id="txtBuscarUsuario" class="input-buscar"
               placeholder="Ingrese ID, usuario o nombre completo del empleado asociado" />
        <button id="btnBuscarUsuario" class="btn-buscar">Buscar</button>
    </div>

    <!-- TODO EL RESULTADO VA AQUÍ -->
    <div id="resultadoUsuario" class="resultado-empleado">
        <p>Ingrese un filtro y presione "Buscar" para ver los usuarios.</p>
    </div>
</div>


<!-- ================= MODAL ACTUALIZAR USUARIO ================= -->
<div id="modalActualizarUsuario" class="modal-actualizar" style="display:none;">
    <div class="modal-content-actualizar">

        <div class="modal-header-actualizar">
            <h2>✏️ Actualizar Usuario</h2>
            <button id="cerrarModalUsuario" class="btn-cerrar-modal">✖</button>
        </div>

        <form id="formActualizarUsuario">
            <input type="hidden" id="IdUsuario" name="IdUsuario" />

            <div class="campo">
                <label for="Usuario1">Usuario</label>
                <input type="text" name="Usuario1" id="Usuario1" required />
            </div>

            <div class="campo">
                <label for="Contrasena">Contraseña</label>
                <input type="text" name="Contrasena" id="Contrasena" required />
            </div>

            <div class="campo">
                <label for="Cargo">Cargo</label>
                <select name="Cargo" id="Cargo" required>
                    <option value="ADMINISTRADOR">ADMINISTRADOR</option>
                    <option value="RRHH">RRHH</option>
                    <option value="TRABAJADOR">TRABAJADOR</option>
                </select>
            </div>

            <div class="acciones-modal">
                <button type="submit" class="btn-guardar-actualizar">Guardar</button>
                <button type="button" id="btnCancelarUsuario" class="btn-cancelar-actualizar">Cancelar</button>
            </div>
        </form>
    </div>
</div>



<!-- ==================  CSS DE MODAL  ================== -->
<style>
    /* === MODAL === */
    .modal-actualizar {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(2,6,23,0.6);
        z-index: 9999;
        padding: 20px;
    }

    .modal-content-actualizar {
        width: 450px;
        max-width: 90%;
        background: #0f1624;
        border-radius: 12px;
        padding: 22px;
        color: #e6eef8;
        box-shadow: 0 0 25px rgba(0,0,0,0.7);
    }

    .modal-header-actualizar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .btn-cerrar-modal {
        background: none;
        border: none;
        color: #cfe3ff;
        font-size: 22px;
        cursor: pointer;
        transition: 0.2s ease;
    }

        .btn-cerrar-modal:hover {
            color: #ff6b6b;
        }


    /* === CAMPOS DE FORMULARIO === */
    .campo {
        margin-bottom: 12px;
        display: flex;
        flex-direction: column;
    }

        .campo input,
        .campo select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.18);
            background: rgba(255,255,255,0.08);
            color: white;
            outline: none;
            font-size: 14px;
            transition: 0.2s ease;
        }

            .campo input:focus,
            .campo select:focus {
                border-color: #6aa9ff;
                box-shadow: 0 0 0 2px rgba(70,130,255,0.3);
            }

        /* === COMBOBOX OSCURO PERSONALIZADO === */
        .campo select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            cursor: pointer;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23cfe3ff' class='bi bi-caret-down-fill' viewBox='0 0 16 16'%3e%3cpath d='M7.247 11.14 2.451 5.658C1.885 5.016 2.345 4 3.204 4h9.592c.86 0 1.32 1.016.753 1.658l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: calc(100% - 12px) center;
            background-size: 16px;
        }

    select option {
        background: #0f1624 !important;
        color: white !important;
        padding: 10px;
        border: none;
    }

        select option:hover {
            background: #1e2a3f !important;
        }


    /* === TARJETA DE USUARIO (RESULTADO) === */
    .usuario-card {
        position: relative;
        border: 1px solid rgba(255,255,255,0.12);
        padding: 18px 15px 22px;
        margin-bottom: 14px;
        border-radius: 10px;
        background: rgba(255,255,255,0.05);
        transition: 0.25s;
    }

        .usuario-card:hover {
            transform: translateY(-2px);
            border-color: rgba(120,170,255,0.45);
        }


    /* === BOTÓN ACTUALIZAR (ESQUINA SUPERIOR DERECHA) === */
    .btn-abrir-modal {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 7px 15px;
        border-radius: 8px;
        background: rgba(40,120,255,0.25);
        border: 1px solid rgba(120,170,255,0.4);
        color: #dce9ff;
        cursor: pointer;
        font-weight: 600;
        backdrop-filter: blur(5px);
        transition: 0.2s ease;
    }

        .btn-abrir-modal:hover {
            background: rgba(40,120,255,0.45);
            border-color: rgba(140,190,255,0.8);
            color: white;
        }


    /* === BOTONES DEL MODAL === */
    .acciones-modal {
        display: flex;
        justify-content: space-between;
        margin-top: 18px;
    }

    .btn-guardar-actualizar {
        padding: 10px 22px;
        border-radius: 8px;
        border: none;
        background: #3a7bff;
        color: white;
        font-weight: 700;
        cursor: pointer;
        transition: 0.2s;
    }

        .btn-guardar-actualizar:hover {
            background: #1f5fe0;
        }

    .btn-cancelar-actualizar {
        padding: 10px 22px;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.25);
        background: transparent;
        color: #cfe3ff;
        cursor: pointer;
        font-weight: 600;
        transition: 0.2s;
    }

        .btn-cancelar-actualizar:hover {
            border-color: rgba(255,120,120,0.7);
            color: #ff7b7b;
        }
</style>





<!-- ==================   JS COMPLETO   ================== -->
<script>
    $(document).ready(function () {

        // BOTÓN BUSCAR
        $("#btnBuscarUsuario").click(function () {

            let filtro = $("#txtBuscarUsuario").val().trim();
            if (filtro === "") return alert("Ingrese un filtro para buscar.");

            $("#resultadoUsuario").html("<p>Buscando...</p>");

            $.post("/ConsultarUsuario/BuscarUsuario", { filtro: filtro }, function (res) {

                $("#resultadoUsuario").html(res); // CARGA AQUÍ EL RESULTADO COMPLETO

                // ACTIVAR BOTONES DE ACTUALIZAR
                $(".btn-abrir-modal").click(function () {
                    abrirModalUsuario($(this));
                });
            });
        });


        // ABRIR MODAL
        function abrirModalUsuario(btn) {

            $("#IdUsuario").val(btn.data("id"));
            $("#Usuario1").val(btn.data("usuario"));
            $("#Contrasena").val(btn.data("contra"));
            $("#Cargo").val(btn.data("cargo"));

            $("#modalActualizarUsuario").fadeIn(150);
        }


        // CERRAR MODAL
        function cerrar() {
            $("#modalActualizarUsuario").fadeOut(120);
            $("#formActualizarUsuario")[0].reset();
        }

        $("#btnCancelarUsuario, #cerrarModalUsuario").click(function () {
            cerrar();
        });


        // GUARDAR AJAX
        $("#formActualizarUsuario").submit(function (e) {
            e.preventDefault();

            let data = $(this).serialize();

            $.post("/ActualizarUsuario/ActualizarUsuarioAjax", data, function (res) {

                if (res.success) {
                    alert("Usuario actualizado correctamente.");
                    cerrar();
                    $("#resultadoUsuario").html("<p>Actualice la búsqueda para ver los cambios.</p>");
                }
                else {
                    alert(res.message);
                }
            });
        });

    });
</script>
